from yacs.config import CfgNode


_C = CfgNode()

_C.USE_GT_POSE = False 
_C.USE_GT_CAM = False
_C.USE_HMR_SHAPE = True

_C.TRAIN_BACKBONE = True 
_C.TRAIN_SCULPTER = True

_C.HMR_HEAD_HEIGHT_CONDITION = True
_C.DELTA_MLP_DEPTH_CONDITION = True
_C.VISUALISE_FREQUENCY = 500

_C.USE_JOINTS = False

# Train
_C.TRAIN = CfgNode()
_C.TRAIN.NUM_EPOCHS = 100
_C.TRAIN.BATCH_SIZE = 8
_C.TRAIN.LR = 0.0001
_C.TRAIN.EPOCHS_PER_SAVE = 3
_C.TRAIN.PIN_MEMORY = True
_C.TRAIN.NUM_WORKERS = 4


# Model
_C.MODEL = CfgNode()
_C.MODEL.GENDER = 'female'
_C.MODEL.NUM_IN_CHANNELS = 18 if _C.USE_JOINTS else 1 
_C.MODEL.NUM_RESNET_LAYERS = 18
_C.MODEL.NUM_SMPL_BETAS = 10
_C.MODEL.MEAN_CAM_T = [0.0, 0.25, 2.5]
_C.MODEL.SMPL_PATH = 'model_files/smpl'
_C.MODEL.HMR_BACKBONE = 'camerahmr'

# Input Data
_C.DATA = CfgNode()
_C.DATA.IMG_SIZE = 256
_C.DATA.HEATMAP_GAUSSIAN_STD = 4.0
_C.DATA.EDGE_NMS = True
_C.DATA.EDGE_THRESHOLD = 0.0
_C.DATA.EDGE_GAUSSIAN_STD = 1.0
_C.DATA.EDGE_GAUSSIAN_SIZE = 5
_C.DATA.TRAIN_POSES_PATH = 'data_files/refit/a_pose_train.npy'
_C.DATA.TRAIN_TEXTURES_PATH = 'data_files/smpl_train_textures.npz'
_C.DATA.TRAIN_BACKGROUNDS_PATH = '/scratches/columbo2/cq244/datasets/on_the_fly_smpl/lsun_backgrounds/train'
_C.DATA.VAL_POSES_PATH = 'data_files/refit/a_pose_val.npy'
_C.DATA.VAL_TEXTURES_PATH = 'data_files/smpl_val_textures.npz'
_C.DATA.VAL_BACKGROUNDS_PATH = '/scratches/columbo2/cq244/datasets/on_the_fly_smpl/lsun_backgrounds/train'#



# Train - Synthetic Data
_C.TRAIN.SYNTH_DATA = CfgNode()
_C.TRAIN.SYNTH_DATA.FOCAL_LENGTH = 200.0
_C.TRAIN.SYNTH_DATA.SINGLE_VIEW_PROB = 0.

# Train - Synthetic Data - Augmentation
_C.TRAIN.SYNTH_DATA.AUGMENT = CfgNode()

_C.TRAIN.SYNTH_DATA.AUGMENT.SMPL = CfgNode()
_C.TRAIN.SYNTH_DATA.AUGMENT.SMPL.SHAPE_STD = 1.75

_C.TRAIN.SYNTH_DATA.AUGMENT.CAM = CfgNode()
_C.TRAIN.SYNTH_DATA.AUGMENT.CAM.DELTA_XY_STD = 0.2
_C.TRAIN.SYNTH_DATA.AUGMENT.CAM.DELTA_Z_RANGE = [-0.75, 0.75]
_C.TRAIN.SYNTH_DATA.AUGMENT.CAM.JITTER_XY_STD = 0.05
_C.TRAIN.SYNTH_DATA.AUGMENT.CAM.JITTER_Z_RANGE = [-0.1, 0.1]

_C.TRAIN.SYNTH_DATA.AUGMENT.RGB = CfgNode()
_C.TRAIN.SYNTH_DATA.AUGMENT.RGB.LIGHT_LOC_RANGE = [0.05, 3.0]
_C.TRAIN.SYNTH_DATA.AUGMENT.RGB.LIGHT_AMBIENT_RANGE = [0.4, 0.8]
_C.TRAIN.SYNTH_DATA.AUGMENT.RGB.LIGHT_DIFFUSE_RANGE = [0.4, 0.8]
_C.TRAIN.SYNTH_DATA.AUGMENT.RGB.LIGHT_SPECULAR_RANGE = [0.0, 0.5]
_C.TRAIN.SYNTH_DATA.AUGMENT.RGB.PIXEL_CHANNEL_NOISE = 0.2

_C.TRAIN.SYNTH_DATA.AUGMENT.PROXY_REP = CfgNode()
_C.TRAIN.SYNTH_DATA.AUGMENT.PROXY_REP.REMOVE_PARTS_CLASSES = []
_C.TRAIN.SYNTH_DATA.AUGMENT.PROXY_REP.REMOVE_PARTS_PROBS = []
_C.TRAIN.SYNTH_DATA.AUGMENT.PROXY_REP.REMOVE_APPENDAGE_JOINTS_PROB = 0.5
_C.TRAIN.SYNTH_DATA.AUGMENT.PROXY_REP.REMOVE_JOINTS_INDICES = [7, 8, 9, 10, 13, 14, 15, 16]  # COCO joint labels
_C.TRAIN.SYNTH_DATA.AUGMENT.PROXY_REP.REMOVE_JOINTS_PROB = 0.1
_C.TRAIN.SYNTH_DATA.AUGMENT.PROXY_REP.DELTA_J2D_DEV_RANGE = [-5, 5]
_C.TRAIN.SYNTH_DATA.AUGMENT.PROXY_REP.JOINTS_TO_SWAP = [[5, 6], [11, 12]]  # COCO joint labels
_C.TRAIN.SYNTH_DATA.AUGMENT.PROXY_REP.JOINTS_SWAP_PROB = 0.1
_C.TRAIN.SYNTH_DATA.AUGMENT.PROXY_REP.OCCLUDE_BOX_DIM = 48
_C.TRAIN.SYNTH_DATA.AUGMENT.PROXY_REP.OCCLUDE_BOX_PROB = 0.0

# Loss
_C.LOSS = CfgNode()
_C.LOSS.REDUCTION = 'mean'
# _C.LOSS.LOSS_TARGETS = ['vertices', 'tpose_vertices', 'joints', 'joints2D', 'pose_rotmats', 'glob_rotmats', 'cam_t', 'd_vc']
_C.LOSS.LOSS_TARGETS = ['vp', 'vc']
_C.LOSS.BACKBONE_TARGETS = ['pose_rotmats', 'glob_rotmats', 'cam_t', 'shape', 'joints', 'joints2D']
_C.LOSS.INIT_WEIGHTS = CfgNode()
_C.LOSS.INIT_WEIGHTS.VP = 1.0
_C.LOSS.INIT_WEIGHTS.VC = 1.0
_C.LOSS.INIT_WEIGHTS.JOINTS = 1.0
_C.LOSS.INIT_WEIGHTS.JOINTS2D = 1.0
_C.LOSS.INIT_WEIGHTS.POSE_ROTMATS = 1.0
_C.LOSS.INIT_WEIGHTS.GLOB_ROTMATS = 1.0
_C.LOSS.INIT_WEIGHTS.CAM_T = 1.0
_C.LOSS.INIT_WEIGHTS.SHAPE = 1.0
_C.LOSS.INIT_WEIGHTS.SILHOUETTES = 1.0
_C.LOSS.INIT_WEIGHTS.D_VC = 1.0

def get_cch_cfg_defaults():
    return _C.clone()